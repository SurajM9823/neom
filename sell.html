<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fashion Store Nepal - Order Form</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">

    <style>
        body {
    background-color: #f8f9fa;
}

.store-title {
    color: #2c3e50;
    font-size: 2rem;
    font-weight: bold;
}

.step-indicator {
    color: #6c757d;
    font-size: 0.9rem;
}

.card {
    border: none;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    margin-bottom: 2rem;
}

.card-title {
    color: #2c3e50;
    font-weight: 600;
}

.table th {
    font-weight: 600;
    color: #2c3e50;
}

.upload-area {
    background-color: #f8f9fa;
    border-color: #dee2e6 !important;
    cursor: pointer;
    transition: all 0.3s ease;
}

.upload-area:hover {
    background-color: #e9ecef;
}

.upload-icon {
    font-size: 2rem;
    color: #6c757d;
}

#uploadText {
    color: #6c757d;
    font-size: 0.9rem;
}

.payment-details {
    background-color: #f8f9fa;
    border-radius: 0.5rem;
}

.payment-details h3 {
    color: #2c3e50;
}

.payment-details p {
    color: #6c757d;
    margin-bottom: 0.5rem;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .store-title {
        font-size: 1.5rem;
    }

    .card-body {
        padding: 1rem;
    }

    .table-responsive {
        margin: 0 -1rem;
    }
}

/* Animation for step transitions */
.step-section {
    opacity: 1;
    transition: opacity 0.3s ease-in-out;
}

.step-section.fade-out {
    opacity: 0;
}

/* Custom styles for form elements */
.form-control:focus,
.form-select:focus {
    border-color: #4a90e2;
    box-shadow: 0 0 0 0.2rem rgba(74, 144, 226, 0.25);
}

.btn-primary {
    background-color: #4a90e2;
    border-color: #4a90e2;
}

.btn-primary:hover {
    background-color: #357abd;
    border-color: #357abd;
}

.btn-success {
    background-color: #28a745;
    border-color: #28a745;
}

.btn-success:hover {
    background-color: #218838;
    border-color: #218838;
}

/* Cart table styles */
.table td {
    vertical-align: middle;
}

.quantity-input {
    width: 70px;
}

.action-button {
    padding: 0.25rem 0.5rem;
    font-size: 0.875rem;
    line-height: 1.5;
    border-radius: 0.2rem;
}

/* Modal styles */
.modal-content {
    border: none;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
}

.modal-header {
    background-color: #f8f9fa;
    border-bottom: 1px solid #dee2e6;
}

.modal-footer {
    background-color: #f8f9fa;
    border-top: 1px solid #dee2e6;
}
    </style>
</head>
<body>
    <div class="container py-5">
        <header class="mb-4">
            <div class="d-flex justify-content-between align-items-center">
                <h1 class="store-title">NEOM WORLD TRADE PVT LTD</h1>
                <div class="step-indicator">Step <span id="currentStep">1</span> of 3</div>
            </div>
        </header>

        <!-- Step 1: Product Selection -->
        <div id="step1" class="step-section">
            <div class="card mb-4">
                <div class="card-body">
                    <h2 class="card-title mb-4">Select Your Product</h2>
                    <div class="mb-3">
                        <label for="productSelect" class="form-label">Choose Product</label>
                        <select id="productSelect" class="form-select">
                            <option value="">Select a product</option>
                        </select>
                    </div>
                    <div class="mb-3" id="sizeSelectContainer" style="display: none;">
                        <label for="sizeSelect" class="form-label">Choose Size</label>
                        <select id="sizeSelect" class="form-select">
                            <option value="">Select a size</option>
                        </select>
                    </div>
                    <button id="addToCartBtn" class="btn btn-primary w-100" disabled>Add to Cart</button>
                </div>
            </div>

            <div class="card">
                <div class="card-body">
                    <h2 class="card-title mb-4">Your Cart</h2>
                    <div class="table-responsive">
                        <table class="table" id="cartTable">
                            <thead>
                                <tr>
                                    <th>Product</th>
                                    <th>Size</th>
                                    <th>Price</th>
                                    <th>Quantity</th>
                                    <th>Total</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="cartItems"></tbody>
                        </table>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mt-4">
                        <div class="h5 mb-0">Total: Rs. <span id="cartTotal">0</span></div>
                        <button id="nextToAddress" class="btn btn-primary" disabled>Next</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 2: Address Form -->
        <div id="step2" class="step-section" style="display: none;">
            <div class="card">
                <div class="card-body">
                    <h2 class="card-title mb-4">Delivery Address</h2>
                    <form id="addressForm">
                        <div class="row g-3">
                            <div class="col-12">
                                <label for="fullName" class="form-label">Full Name</label>
                                <input type="text" class="form-control" id="fullName" required>
                            </div>
                            <div class="col-md-6">
                                <label for="email" class="form-label">Email</label>
                                <input type="email" class="form-control" id="email" required>
                            </div>
                            <div class="col-md-6">
                                <label for="phone" class="form-label">Phone Number</label>
                                <input type="tel" class="form-control" id="phone" required>
                            </div>
                            <div class="col-md-6">
                                <label for="province" class="form-label">Province</label>
                                <select class="form-select" id="province" required>
                                    <option value="">Select Province</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="district" class="form-label">District</label>
                                <select class="form-select" id="district" required disabled>
                                    <option value="">Select District</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="municipality" class="form-label">Municipality</label>
                                     <input type="text" class="form-control" id="municipality" required>
                            </div>
                            <div class="col-md-3">
                                <label for="ward" class="form-label">Ward No.</label>
                                <input type="number" class="form-control" id="ward" min="1" max="32" required>
                            </div>
                            <div class="col-md-3">
                                <label for="tole" class="form-label">Tole/Street</label>
                                <input type="text" class="form-control" id="tole" required>
                            </div>
                        </div>
                        <div class="d-flex justify-content-between mt-4">
                            <button type="button" class="btn btn-secondary" id="backToCart">Back</button>
                            <button type="submit" class="btn btn-primary">Next</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Step 3: Payment -->
        <div id="step3" class="step-section" style="display: none;">
            <div class="card">
                <div class="card-body">
                    <h2 class="card-title mb-4">Payment Details</h2>
                    <div class="mb-4">
                        <label class="form-label">Payment Method</label>
                        <div class="d-flex gap-3">
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="paymentMethod" id="bankTransfer" value="bank" checked>
                                <label class="form-check-label" for="bankTransfer">Bank Transfer</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="paymentMethod" id="esewa" value="esewa">
                                <label class="form-check-label" for="esewa">eSewa</label>
                            </div>
                        </div>
                    </div>

                    <div id="bankDetails" class="payment-details bg-light p-3 rounded mb-4">
                        <h3 class="h5 mb-3">Bank Details</h3>
                        <p class="mb-1">Bank: Nepal Bank Limited</p>
                        <p class="mb-1">Account Holder: NEOM WORLD TRADE PVT LTD</p>
                        <p class="mb-1">Account Number: 0123456789</p>
                    </div>

                    <div id="esewaDetails" class="payment-details bg-light p-3 rounded mb-4" style="display: none;">
                        <h3 class="h5 mb-3">eSewa Details</h3>
                        <p class="mb-1">eSewa ID: fashion@esewa</p>
                    </div>

                    <div class="text-center mb-4">
                        <img id="qrCode" src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=https://example.com/payment" alt="Payment QR Code" class="img-fluid mb-2" style="max-width: 200px;">
                        <br>
                        <a href="#" id="downloadQR" class="btn btn-link">Download QR Code</a>
                    </div>

                    <div class="mb-4">
                        <label class="form-label">Upload Payment Slip</label>
                        <div class="upload-area p-4 text-center border border-2 border-dashed rounded">
                            <input type="file" id="paymentSlip" accept=".pdf,.jpg,.jpeg,.png" class="d-none">
                            <label for="paymentSlip" class="mb-0 cursor-pointer">
                                <div class="upload-icon mb-2">📤</div>
                                <span id="uploadText">Click to upload payment slip (PDF, JPG)</span>
                            </label>
                        </div>
                    </div>

                    <div class="d-flex justify-content-between">
                        <button class="btn btn-secondary" id="backToAddress">Back</button>
                        <button class="btn btn-success" id="confirmOrder" disabled>Confirm Order</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Order Confirmation Modal -->
        <div class="modal fade" id="confirmationModal" tabindex="-1">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Order Confirmed!</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <p>Your order has been successfully placed. Thank you for shopping with us!</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" id="downloadInvoice">Download Invoice</button>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="script.js"></script>

    <script>
        // Product data
const products = [
    {
        id: 1,
        name: "Baby Charm",
        price: 1200,
        sizes: ["New Born", "Maxi", "Junior", "XL"]
    },
    {
        id: 2,
        name: "Helen Harper",
        price: 2500,
        sizes: ["Junior", "Maxi", "XL"]
    }
];

// Location data
const provinces = [
    "Koshi",
    "Madhesh",
    "Bagmati",
    "Gandaki",
    "Lumbini",
    "Karnali",
    "Sudurpashchim"
];

const districts = {
    "Koshi": ["Bhojpur", "Dhankuta", "Ilam", "Jhapa", "Khotang", "Morang", "Okhaldhunga", "Panchthar", "Sankhuwasabha", "Solukhumbu", "Sunsari", "Taplejung", "Terhathum", "Udayapur"],
    "Madhesh": ["Saptari", "Siraha", "Dhanusha", "Mahottari", "Sarlahi", "Rautahat", "Bara", "Parsa"],
    "Bagmati": ["Bhaktapur", "Chitwan", "Dhading", "Dolakha", "Kathmandu", "Kavrepalanchok", "Lalitpur", "Makwanpur", "Nuwakot", "Ramechhap", "Rasuwa", "Sindhuli", "Sindhupalchok"],
    "Gandaki": ["Baglung", "Gorkha", "Kaski", "Lamjung", "Manang", "Mustang", "Myagdi", "Nawalpur", "Parbat", "Syangja", "Tanahun"],
    "Lumbini": ["Arghakhanchi", "Banke", "Bardiya", "Dang", "Eastern Rukum", "Gulmi", "Kapilvastu", "Parasi", "Palpa", "Pyuthan", "Rolpa", "Rupandehi"],
    "Karnali": ["Dailekh", "Dolpa", "Humla", "Jajarkot", "Jumla", "Kalikot", "Mugu", "Salyan", "Surkhet", "Western Rukum"],
    "Sudurpashchim": ["Achham", "Baitadi", "Bajhang", "Bajura", "Dadeldhura", "Darchula", "Doti", "Kailali", "Kanchanpur"]
};

// State management
let cart = [];
let currentStep = 1;
let orderData = {
    items: [],
    address: {},
    payment: {
        method: 'bank',
        slip: null
    }
};

// Initialize the page
document.addEventListener('DOMContentLoaded', () => {
    initializeProductSelect();
    initializeLocationSelects();
    setupEventListeners();
    updateStepIndicator();
});

// Product selection initialization
function initializeProductSelect() {
    const productSelect = document.getElementById('productSelect');
    products.forEach(product => {
        const option = document.createElement('option');
        option.value = product.id;
        option.textContent = `${product.name} - Rs. ${product.price}`;
        productSelect.appendChild(option);
    });
}

// Location selects initialization
function initializeLocationSelects() {
    const provinceSelect = document.getElementById('province');
    provinces.forEach(province => {
        const option = document.createElement('option');
        option.value = province;
        option.textContent = province;
        provinceSelect.appendChild(option);
    });
}

// Event listeners setup
function setupEventListeners() {
    // Product selection events
    document.getElementById('productSelect').addEventListener('change', handleProductChange);
    document.getElementById('sizeSelect').addEventListener('change', handleSizeChange);
    document.getElementById('addToCartBtn').addEventListener('click', handleAddToCart);

    // Navigation events
    document.getElementById('nextToAddress').addEventListener('click', () => navigateToStep(2));
    document.getElementById('backToCart').addEventListener('click', () => navigateToStep(1));
    document.getElementById('backToAddress').addEventListener('click', () => navigateToStep(2));
    
    // Address form events
    document.getElementById('addressForm').addEventListener('submit', handleAddressSubmit);
    document.getElementById('province').addEventListener('change', handleProvinceChange);
    document.getElementById('district').addEventListener('change', handleDistrictChange);

    // Payment events
    document.querySelectorAll('input[name="paymentMethod"]').forEach(radio => {
        radio.addEventListener('change', handlePaymentMethodChange);
    });
    document.getElementById('paymentSlip').addEventListener('change', handleSlipUpload);
    document.getElementById('confirmOrder').addEventListener('click', handleOrderConfirmation);
    document.getElementById('downloadInvoice').addEventListener('click', generatePDF);
}

// Product selection handlers
function handleProductChange(e) {
    const productId = Number(e.target.value);
    const product = products.find(p => p.id === productId);
    const sizeSelect = document.getElementById('sizeSelect');
    const sizeContainer = document.getElementById('sizeSelectContainer');

    if (product) {
        sizeSelect.innerHTML = '<option value="">Select a size</option>';
        product.sizes.forEach(size => {
            const option = document.createElement('option');
            option.value = size;
            option.textContent = size;
            sizeSelect.appendChild(option);
        });
        sizeContainer.style.display = 'block';
    } else {
        sizeContainer.style.display = 'none';
    }
    
    updateAddToCartButton();
}

function handleSizeChange() {
    updateAddToCartButton();
}

function updateAddToCartButton() {
    const productSelect = document.getElementById('productSelect');
    const sizeSelect = document.getElementById('sizeSelect');
    const addToCartBtn = document.getElementById('addToCartBtn');
    
    addToCartBtn.disabled = !productSelect.value || !sizeSelect.value;
}

function handleAddToCart() {
    const productId = Number(document.getElementById('productSelect').value);
    const size = document.getElementById('sizeSelect').value;
    const product = products.find(p => p.id === productId);

    if (product && size) {
        const cartItem = {
            id: Date.now(),
            productId,
            name: product.name,
            size,
            quantity: 1,
            price: product.price
        };

        cart.push(cartItem);
        updateCart();
        
        // Reset selections
        document.getElementById('productSelect').value = '';
        document.getElementById('sizeSelect').value = '';
        document.getElementById('sizeSelectContainer').style.display = 'none';
        updateAddToCartButton();
    }
}

// Cart management
function updateCart() {
    const cartItems = document.getElementById('cartItems');
    const cartTotal = document.getElementById('cartTotal');
    const nextBtn = document.getElementById('nextToAddress');

    cartItems.innerHTML = '';
    let total = 0;

    cart.forEach(item => {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${item.name}</td>
            <td>${item.size}</td>
            <td>Rs. ${item.price}</td>
            <td>
                <input type="number" min="1" value="${item.quantity}" 
                    class="form-control quantity-input" 
                    onchange="updateQuantity(${item.id}, this.value)">
            </td>
            <td>Rs. ${item.price * item.quantity}</td>
            <td>
                <button class="btn btn-danger btn-sm" onclick="removeItem(${item.id})">
                    Remove
                </button>
            </td>
        `;
        cartItems.appendChild(row);
        total += item.price * item.quantity;
    });

    cartTotal.textContent = total;
    nextBtn.disabled = cart.length === 0;
    orderData.items = [...cart];
}

function updateQuantity(id, quantity) {
    const item = cart.find(item => item.id === id);
    if (item) {
        item.quantity = Math.max(1, parseInt(quantity) || 1);
        updateCart();
    }
}

function removeItem(id) {
    cart = cart.filter(item => item.id !== id);
    updateCart();
}

// Navigation
function navigateToStep(step) {
    const currentSection = document.getElementById(`step${currentStep}`);
    const nextSection = document.getElementById(`step${step}`);
    
    currentSection.style.display = 'none';
    nextSection.style.display = 'block';
    
    currentStep = step;
    updateStepIndicator();
}

function updateStepIndicator() {
    document.getElementById('currentStep').textContent = currentStep;
}

// Address form handlers
function handleAddressSubmit(e) {
    e.preventDefault();
    orderData.address = {
        name: document.getElementById('fullName').value,
        email: document.getElementById('email').value,
        phone: document.getElementById('phone').value,
        province: document.getElementById('province').value,
        district: document.getElementById('district').value,
        municipality: document.getElementById('municipality').value,
        ward: document.getElementById('ward').value,
        tole: document.getElementById('tole').value
    };
    navigateToStep(3);
}

function handleProvinceChange(e) {
    const province = e.target.value;
    const districtSelect = document.getElementById('district');
    const municipalitySelect = document.getElementById('municipality');

    districtSelect.innerHTML = '<option value="">Select District</option>';
    municipalitySelect.innerHTML = '<option value="">Select Municipality</option>';

    if (province && districts[province]) {
        districts[province].forEach(district => {
            const option = document.createElement('option');
            option.value = district;
            option.textContent = district;
            districtSelect.appendChild(option);
        });
        districtSelect.disabled = false;
    } else {
        districtSelect.disabled = true;
    }
    municipalitySelect.disabled = false;
}

function handleDistrictChange(e) {
    
}

// Payment handlers
function handlePaymentMethodChange(e) {
    const method = e.target.value;
    orderData.payment.method = method;
    
    document.getElementById('bankDetails').style.display = method === 'bank' ? 'block' : 'none';
    document.getElementById('esewaDetails').style.display = method === 'esewa' ? 'block' : 'none';
    
    const qrCode = document.getElementById('qrCode');
    qrCode.src = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${method === 'bank' ? 'bank-payment' : 'esewa-payment'}`;
}

function handleSlipUpload(e) {
    const file = e.target.files[0];
    if (file) {
        orderData.payment.slip = file;
        document.getElementById('uploadText').textContent = file.name;
        document.getElementById('confirmOrder').disabled = false;
    }
}

function handleOrderConfirmation() {
    const modal = new bootstrap.Modal(document.getElementById('confirmationModal'));
    modal.show();
}
function generatePDF() {
    // Create the content container
    const content = document.createElement('div');
    content.style.fontFamily = 'Arial, sans-serif';
    content.style.width = '100%';
    content.style.maxHeight = '10in'; // Approx letter size height to force single page
    content.style.boxSizing = 'border-box';

    content.innerHTML = `
        <div style="padding: 15px; line-height: 1.5; color: #333; background: linear-gradient(to bottom, #f8f9fa, #ffffff); border: 1px solid #dee2e6;">
            <!-- Header -->
            <div style="display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #007bff; padding-bottom: 10px; margin-bottom: 15px;">
                <div>
                    <h1 style="margin: 0; font-size: 26px; color: #007bff; font-weight: bold;">NEOM World Trade PVT. LTD.</h1>
                    <p style="margin: 2px 0; font-size: 12px; color: #555;">Thamel, Kathmandu, Nepal</p>
                    <p style="margin: 2px 0; font-size: 12px; color: #555;">+977-9842145414 | support@neom.com.np</p>
                </div>
                <div style="text-align: right;">
                    <span style="font-size: 14px; color: #28a745; font-weight: bold;">INVOICE</span><br>
                    <span style="font-size: 12px; color: #666;">Order ID: ${Date.now()}</span>
                </div>
            </div>

            <!-- Order & Customer Info -->
            <div style="display: flex; justify-content: space-between; margin-bottom: 15px; font-size: 13px;">
                <div style="background: #fff; padding: 10px; border-radius: 5px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); width: 48%;">
                    <h2 style="font-size: 16px; margin: 0 0 8px; color: #007bff;">Order Information</h2>
                    <p style="margin: 2px 0;"><strong>Date:</strong> ${new Date().toLocaleDateString()}</p>
                    <p style="margin: 2px 0;"><strong>Time:</strong> ${new Date().toLocaleTimeString()}</p>
                </div>
                <div style="background: #fff; padding: 10px; border-radius: 5px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); width: 48%;">
                    <h2 style="font-size: 16px; margin: 0 0 8px; color: #007bff;">Customer Details</h2>
                    <p style="margin: 2px 0;"><strong>Name:</strong> ${orderData.address.name}</p>
                    <p style="margin: 2px 0;"><strong>Email:</strong> ${orderData.address.email}</p>
                    <p style="margin: 2px 0;"><strong>Phone:</strong> ${orderData.address.phone}</p>
                </div>
            </div>

            <!-- Delivery Address -->
            <div style="margin-bottom: 15px; background: #fff; padding: 10px; border-radius: 5px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); font-size: 13px;">
                <h2 style="font-size: 16px; margin: 0 0 8px; color: #007bff;">Delivery Address</h2>
                <p style="margin: 0;">${orderData.address.name}, ${orderData.address.tole}, Ward ${orderData.address.ward},</p>
                <p style="margin: 0;">${orderData.address.municipality}, ${orderData.address.district}, ${orderData.address.province}, Nepal</p>
            </div>

            <!-- Product Table -->
            <div style="margin-bottom: 15px;">
                <h2 style="font-size: 16px; margin: 0 0 8px; color: #007bff;">Order Items</h2>
                <table style="width: 100%; border-collapse: collapse; font-size: 12px; background: #fff; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                    <thead>
                        <tr style="background: #007bff; color: #fff;">
                            <th style="padding: 8px; text-align: left; border-bottom: 2px solid #0056b3;">Item</th>
                            <th style="padding: 8px; text-align: center; border-bottom: 2px solid #0056b3;">Size</th>
                            <th style="padding: 8px; text-align: right; border-bottom: 2px solid #0056b3;">Unit Price</th>
                            <th style="padding: 8px; text-align: center; border-bottom: 2px solid #0056b3;">Quantity</th>
                            <th style="padding: 8px; text-align: right; border-bottom: 2px solid #0056b3;">Total</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${orderData.items.map((item, index) => `
                            <tr style="${index % 2 === 0 ? 'background: #f8f9fa;' : ''}">
                                <td style="padding: 8px; border-bottom: 1px solid #dee2e6;">${item.name}</td>
                                <td style="padding: 8px; text-align: center; border-bottom: 1px solid #dee2e6;">${item.size}</td>
                                <td style="padding: 8px; text-align: right; border-bottom: 1px solid #dee2e6;">Rs. ${item.price.toFixed(2)}</td>
                                <td style="padding: 8px; text-align: center; border-bottom: 1px solid #dee2e6;">${item.quantity}</td>
                                <td style="padding: 8px; text-align: right; border-bottom: 1px solid #dee2e6;">Rs. ${(item.price * item.quantity).toFixed(2)}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            </div>

            <!-- Total Amount -->
            <div style="text-align: right; margin-bottom: 15px;">
                <table style="width: 40%; float: right; border-collapse: collapse; font-size: 13px; background: #fff; border-radius: 5px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                    <tr>
                        <td style="padding: 8px; text-align: right; color: #555;">Subtotal:</td>
                        <td style="padding: 8px; text-align: right;">Rs. ${orderData.items.reduce((sum, item) => sum + (item.price * item.quantity), 0).toFixed(2)}</td>
                    </tr>
                    <tr>
                        <td style="padding: 8px; text-align: right; color: #555;">Shipping:</td>
                        <td style="padding: 8px; text-align: right;">Rs. 0.00</td>
                    </tr>
                    <tr style="border-top: 2px solid #007bff;">
                        <td style="padding: 8px; text-align: right; font-weight: bold; color: #007bff;">Grand Total:</td>
                        <td style="padding: 8px; text-align: right; font-weight: bold; color: #007bff;">Rs. ${orderData.items.reduce((sum, item) => sum + (item.price * item.quantity), 0).toFixed(2)}</td>
                    </tr>
                </table>
            </div>

            <!-- Payment Details -->
            <div style="margin-bottom: 15px; background: #fff; padding: 10px; border-radius: 5px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); font-size: 13px; clear: both;">
                <h2 style="font-size: 16px; margin: 0 0 8px; color: #007bff;">Payment Details</h2>
                <p style="margin: 2px 0;"><strong>Method:</strong> ${orderData.payment.method === 'bank' ? 'Bank Transfer' : 'eSewa'}</p>
                ${orderData.payment.slip ? `<p style="margin: 2px 0;"><strong>Payment Slip:</strong> ${orderData.payment.slip.name}</p>` : ''}
            </div>

            <!-- Footer -->
            <div style="border-top: 2px solid #007bff; padding-top: 10px; text-align: center; font-size: 11px; color: #666; margin-top: 15px;">
                <p style="margin: 2px 0;">Thank you for shopping with <strong>NEOM World Trade!</strong></p>
                <p style="margin: 2px 0;">For queries: +977-9842145414 | support@neom.com</p>
                <p style="margin: 2px 0; font-style: italic;">This is a computer-generated invoice</p>
            </div>
        </div>
    `;

    // PDF generation options
    const opt = {
        margin: [0.3, 0.5, 0.3, 0.5], // Reduced top/bottom margins for single-page fit
        filename: `invoice-${Date.now()}.pdf`,
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { 
            scale: 2,
            logging: false,
            useCORS: true,
            scrollY: 0,
            windowHeight: 1100 // Approximate letter height in pixels to capture all content
        },
        jsPDF: { 
            unit: 'in', 
            format: 'letter', 
            orientation: 'portrait',
            compress: true
        },
        pagebreak: { 
            mode: ['css'], // Rely on CSS for page breaks
            avoid: ['table', '.avoid-break'] // Avoid breaking tables
        }
    };

    // Generate and save the PDF
    html2pdf()
        .set(opt)
        .from(content)
        .toPdf()
        .get('pdf')
        .then(pdf => {
            // Ensure single page by adjusting content scaling if needed
            const totalPages = pdf.internal.getNumberOfPages();
            if (totalPages > 1) {
                console.warn('Content exceeds one page; consider reducing content size.');
            }
        })
        .save()
        .catch(err => console.error('PDF generation error:', err));
}

</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</body>
</html>